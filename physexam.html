<!DOCTYPE html>
<html lang="zh-tw">

<head>

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>  

<script>
function mouseDown(e){
    this.draw=true;
    this.ctx = this.getContext("2d");
    this.ctx.strokeStyle='#000000';
    this.ctx.lineWidth=2;

    var o=this;
    this.offsetX=this.offsetLeft;
    this.offsetY=this.offsetTop;

    while(o.offsetParent){
        o=o.offsetParent;
        this.offsetX+=o.offsetLeft;
        this.offsetY+=o.offsetTop;
    }

    this.ctx.beginPath();
    this.ctx.moveTo(e.pageX-this.offsetX,e.pageY-this.offsetY);
}

function mouseMove(e){
    if (this.draw){
        this.ctx.lineTo(e.pageX-this.offsetX,e.pageY-this.offsetY);
        this.ctx.stroke();
    }
}

function mouseUp(e){
    this.draw=false;
}

function touchStart(e){
    this.draw=true;
    this.ctx=this.getContext("2d");
    this.touch=e.targetTouches[0];
    this.ctx.strokeStyle='#000000';
    this.ctx.lineWidth=2;

    var o=this;
    this.offsetX=this.offsetLeft;
    this.offsetY=this.offsetTop;

    while(o.offsetParent){
        o=o.offsetParent;
        this.offsetX+=o.offsetLeft;
        this.offsetY+=o.offsetTop;
    }

    this.ctx.beginPath();
    this.ctx.moveTo(this.touch.pageX-this.offsetX,this.touch.pageY-this.offsetY);
    e.preventDefault();
}

function touchMove(e){
    this.touch=e.targetTouches[0];
    if (this.draw){
        this.ctx.lineTo(this.touch.pageX-this.offsetX,this.touch.pageY-this.offsetY);
        this.ctx.stroke();
    }
    e.preventDefault();
}

function touchEnd(e){
    this.draw=false;
    e.preventDefault();
}

function clearPad(){
    var canvas=document.querySelector('#myCanvas');
    var ctx=canvas.getContext("2d");
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

window.addEventListener('load',function(){
    var canvas=document.querySelector('#myCanvas');

    canvas.addEventListener('mousedown',mouseDown);
    canvas.addEventListener('mousemove',mouseMove);
    canvas.addEventListener('mouseup',mouseUp);

    canvas.addEventListener('touchstart',touchStart);
    canvas.addEventListener('touchmove',touchMove);
    canvas.addEventListener('touchend',touchEnd);
});

</script>



</head>

<body >

<div style="text-align:center;">
<h2>高中物理題目練習</h2>
</div>
<h3 id="score" style="text-align:center;visibility:hidden"></h3>
<div style="text-align:center;" id="forusername">
  <p></p>
  <input type="text" style="text-align:center;" id="username" placeholder="請輸入名字"><br>

  <select name="select" id="selectTest" >
    <option>請選擇練習單元</option>
    <option>高一緒論</option>
    <option>高一電與磁的統一</option>
    <option>高一物質的組成</option>
    <option>高一量子現象</option>
    <option>高二簡諧運動</option>
    <option>高二萬有引力</option>

 </select><br><br>

</div>



 

<div id="Btn" style="text-align:center;">
  <button id="sendBtn" onclick="send()">開始測驗</button><br><br>
  <button id="reBtn" style="visibility:hidden" onclick="location.href='https://ahongnotes.com/physhistorytest'">再玩一次</button><br><br>
  <button id="rankBtn" style="visibility:hidden" onclick="rank()">看排名</button><br>
</div>
<h4 id="questionTitle"></h4> 
<h4 id="fromyear"></h4>
<img  id="question" src="" width="95%" style="visibility:hidden; text-align:center;"></img><br>    
<h4 id="chooseAnswer"></h4>


<div id="answer" style="visibility:hidden;">
    <div style="display:inline;"><button id="answer1" onclick="check(this)" style="width:18%;"></button></div>
  <div style="display:inline;"><button id="answer2" onclick="check(this)" style="width:18%;"></button></div>
  <div style="display:inline;"><button id="answer3" onclick="check(this)" style="width:18%;"></button></div>
  <div style="display:inline;"><button id="answer4" onclick="check(this)" style="width:18%;"></button></div>
  <div style="display:inline;"><button id="answer5" onclick="check(this)" style="width:18%;"></button></div>

</div>
<div id="paper" style="text-align:center;visibility:hidden;">
  <p>計算區</p>
    <button onclick="clearPad();">清空計算區</button><br>
   
  
    <canvas id="myCanvas" width="300" height="600" style="position:relative;border:#000 1px solid;"></canvas>

</div>


<div id="testtable" style="visibility:hidden; text-align:center;">
<table   border="1" style="border:3px #FFAC55 solid;padding:5px;width:90%;" rules="all"  align="center" >
  <tr align="center">
    <td >題號</td>
    <td >題目</td>
    <td >正確答案</td>
    <td >回答</td>
    <td >詳解</td>
  </tr>
  <tr align="center">
    <td >1</td>
    <td ><img  id="q1" width="100%" src="" ></img></td>
    <td id="a1"></td>
    <td id="1"></td>
    <td ><a id="ad1" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >2</td>
    <td ><img  id="q2" width="100%" src="" ></img></td>
    <td id="a2"></td>
    <td id="2"></td>
    <td ><a id="ad2" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >3</td>
    <td ><img  id="q3" width="100%" src="" ></img></td>
    <td id="a3"></td>
    <td id="3"></td>
    <td ><a id="ad3" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >4</td>
    <td ><img  id="q4" width="100%" src="" ></img></td>
    <td id="a4"></td>
    <td id="4"></td>
    <td ><a id="ad4" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >5</td>
    <td ><img  id="q5" width="100%" src="" ></img></td>
    <td id="a5"></td>
    <td id="5"></td>
    <td ><a id="ad5" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >6</td>
    <td ><img  id="q6" width="100%" src="" ></img></td>
    <td id="a6"></td>
    <td id="6"></td>
    <td ><a id="ad6" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >7</td>
    <td ><img  id="q7" width="100%" src="" ></img></td>
    <td id="a7"></td>
    <td id="7"></td>
    <td ><a id="ad7" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >8</td>
    <td ><img  id="q8" width="100%" src="" ></img></td>
    <td id="a8"></td>
    <td id="8"></td>
   <td ><a id="ad8" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >9</td>
    <td ><img  id="q9" width="100%" src="" ></img></td>
    <td id="a9"></td>
    <td id="9"></td>
    <td ><a id="ad9" href="" target="_blank">詳解</a></td>
  </tr>
  <tr align="center">
    <td >10</td>
    <td ><img  id="q10" width="100%" src="" ></img></td>
    <td id="a10"></td>
    <td id="10"></td>
    <td ><a id="ad10" href="" target="_blank">詳解</a></td>
  </tr>
</table>
</div>






<script >


var correctAnswer;
var usernamevalue;
var times;
var parameter;

var questiondata;



var score;

var x=[];

var correctAnswerArray=[];
var choiceAnswerArray=[];
var questionnumber;






var questionexcel=10;

function send() { 

  if (document.getElementById("username").value==""){
         alert("請輪入姓名"); 
      }else if(document.getElementById("selectTest").value=="請選擇練習單元"){
        alert("請選擇練習單元"); 

      }else{

    
    $.get("https://script.google.com/macros/s/AKfycbzMPT8umxfBHTdJ39IJUNdFSXPu1fFB9Er-_gTxpKHIhFJY6GEn/exec", {
         "selectTest": document.getElementById("selectTest").value

     }, function(data) {
        
              questiondata=data.split(",");

              questionnumber=questiondata[0]-1;     

              usernamevalue=document.getElementById("username").value;

                score=0;

                times=1;

        var index = 1;

        while (index < 11) {

                       var flag = true;
                       var num = Math.floor(Math.random() * questionnumber)+1;
                       for (var i in x) {
                       if (x[i] == num) {
                       flag = false;
                       }
                       }
                       if (flag == true) {
                       x[index] = num;
                       index++;
                       }
                    }

        document.getElementById("username").style.display='none';
        document.getElementById("forusername").style.display='none';
        document.getElementById("sendBtn").style.display='none';
        document.getElementById("Btn").style.display='none';

        document.getElementById("question").style.visibility='visible'; 
        document.getElementById("answer").style.visibility='visible'; 
        document.getElementById("paper").style.visibility='visible'; 

         var screenW = document.documentElement.clientWidth*0.9;     //屏幕寬度
         var screenH = document.documentElement.clientHeight; 

         var canvas = document.getElementById("myCanvas"); 

         canvas.width = screenW ;
         canvas.height = screenH;


        
        document.getElementById("questionTitle").innerHTML="題目"+times;
        document.getElementById("fromyear").innerHTML="&nbsp&nbsp&nbsp出自"+questiondata[x[times]*questionexcel];
        
        document.getElementById("question").src=questiondata[x[times]*questionexcel+3];

        document.getElementById("chooseAnswer").innerHTML="請選擇答案";

        correctAnswer=questiondata[x[times]*questionexcel+4];


        var answerarray=[questiondata[x[times]*questionexcel+4],questiondata[x[times]*questionexcel+5],questiondata[x[times]*questionexcel+6],questiondata[x[times]*questionexcel+7],questiondata[x[times]*questionexcel+8]];

        answerarray.sort();

        document.getElementById("answer1").innerHTML=answerarray[0];
        document.getElementById("answer2").innerHTML=answerarray[1];
        document.getElementById("answer3").innerHTML=answerarray[2];
        document.getElementById("answer4").innerHTML=answerarray[3];
        document.getElementById("answer5").innerHTML=answerarray[4];


        document.getElementById("q1").src=questiondata[x[1]*questionexcel+3];
        document.getElementById("q2").src=questiondata[x[2]*questionexcel+3];
        document.getElementById("q3").src=questiondata[x[3]*questionexcel+3];
        document.getElementById("q4").src=questiondata[x[4]*questionexcel+3];
        document.getElementById("q5").src=questiondata[x[5]*questionexcel+3];
        document.getElementById("q6").src=questiondata[x[6]*questionexcel+3];
        document.getElementById("q7").src=questiondata[x[7]*questionexcel+3];
        document.getElementById("q8").src=questiondata[x[8]*questionexcel+3];
        document.getElementById("q9").src=questiondata[x[9]*questionexcel+3];
        document.getElementById("q10").src=questiondata[x[10]*questionexcel+3];

        document.getElementById("a1").innerHTML=questiondata[x[1]*questionexcel+4];
        document.getElementById("a2").innerHTML=questiondata[x[2]*questionexcel+4];
        document.getElementById("a3").innerHTML=questiondata[x[3]*questionexcel+4];
        document.getElementById("a4").innerHTML=questiondata[x[4]*questionexcel+4];
        document.getElementById("a5").innerHTML=questiondata[x[5]*questionexcel+4];
        document.getElementById("a6").innerHTML=questiondata[x[6]*questionexcel+4];
        document.getElementById("a7").innerHTML=questiondata[x[7]*questionexcel+4];
        document.getElementById("a8").innerHTML=questiondata[x[8]*questionexcel+4];
        document.getElementById("a9").innerHTML=questiondata[x[9]*questionexcel+4];
        document.getElementById("a10").innerHTML=questiondata[x[10]*questionexcel+4];

        document.getElementById("ad1").href=questiondata[x[1]*questionexcel+9];
        document.getElementById("ad2").href=questiondata[x[2]*questionexcel+9];
        document.getElementById("ad3").href=questiondata[x[3]*questionexcel+9];
        document.getElementById("ad4").href=questiondata[x[4]*questionexcel+9];
        document.getElementById("ad5").href=questiondata[x[5]*questionexcel+9];
        document.getElementById("ad6").href=questiondata[x[6]*questionexcel+9];
        document.getElementById("ad7").href=questiondata[x[7]*questionexcel+9];
        document.getElementById("ad8").href=questiondata[x[8]*questionexcel+9];
        document.getElementById("ad9").href=questiondata[x[9]*questionexcel+9];
        document.getElementById("ad10").href=questiondata[x[10]*questionexcel+9];
 
             
      });




           
        


      }
}

 

 
 function check(id) { 

    choiceAnswerArray[times]=id.innerHTML;
    document.getElementById(times).innerHTML=id.innerHTML;


    if(id.innerHTML==correctAnswer&&times<10){
      
      score=score+10;

      times=times+1;

       
      

        document.getElementById("questionTitle").innerHTML="題目"+times;
        document.getElementById("fromyear").innerHTML="&nbsp&nbsp&nbsp出自"+questiondata[x[times]*questionexcel];
        
        document.getElementById("question").src=questiondata[x[times]*questionexcel+3];

        document.getElementById("chooseAnswer").innerHTML="請選擇答案";

        correctAnswer=questiondata[x[times]*questionexcel+4];

        var answerarray=[questiondata[x[times]*questionexcel+4],questiondata[x[times]*questionexcel+5],questiondata[x[times]*questionexcel+6],questiondata[x[times]*questionexcel+7],questiondata[x[times]*questionexcel+8]];
        answerarray.sort();
        document.getElementById("answer1").innerHTML=answerarray[0];
        document.getElementById("answer2").innerHTML=answerarray[1];
        document.getElementById("answer3").innerHTML=answerarray[2];
        document.getElementById("answer4").innerHTML=answerarray[3];
        document.getElementById("answer5").innerHTML=answerarray[4];

    }else if (id.innerHTML==correctAnswer&&times==10) {

    score=score+10;
    
    alert("完成測驗");

     var gametime=new Date();

     $.get("https://script.google.com/macros/s/AKfycbzPf_3QE5-pPyjEhv42hnw5_mglVWhEf7E_pnIZ/exec", {
         "name": document.getElementById("username").value,
         "gametime":gametime,
         "gamescore":score,
         "selectTest":document.getElementById("selectTest").value

     }, function(data) {
        
             alert("成績已登記");
             
      });
    document.getElementById("score").innerHTML="本次測驗得分:"+score+"分"


    document.getElementById("questionTitle").style.display='none';
    document.getElementById("fromyear").style.display='none';
    document.getElementById("question").style.display='none';
    document.getElementById("chooseAnswer").style.display='none';
    document.getElementById("answer").style.display='none';
    document.getElementById("score").style.visibility='visible'; 
    document.getElementById("testtable").style.visibility='visible';
    document.getElementById("paper").remove();

   



    }else if (times==10) {

    
    alert("完成測驗");
    document.getElementById("paper").remove();

     var gametime=new Date();

     $.get("https://script.google.com/macros/s/AKfycbzPf_3QE5-pPyjEhv42hnw5_mglVWhEf7E_pnIZ/exec", {
         "name": document.getElementById("username").value,
         "gametime":gametime,
         "gamescore":score,
         "selectTest":document.getElementById("selectTest").value

     }, function(data) {
        
             alert("成績已登記");
             
      });
    

    document.getElementById("score").innerHTML="本次測驗得分:"+score+"分";

    var gametime=new Date();

    


    document.getElementById("questionTitle").style.display='none';
    document.getElementById("fromyear").style.display='none';
    document.getElementById("question").style.display='none';
    document.getElementById("chooseAnswer").style.display='none';
    document.getElementById("answer").style.display='none';
    document.getElementById("score").style.visibility='visible';
    document.getElementById("testtable").style.visibility='visible';

    }else{
    
    times=times+1;
      

        document.getElementById("questionTitle").innerHTML="題目"+times;
        document.getElementById("fromyear").innerHTML="&nbsp&nbsp&nbsp出自"+questiondata[x[times]*questionexcel];
        
        document.getElementById("question").src=questiondata[x[times]*questionexcel+3];

        document.getElementById("chooseAnswer").innerHTML="請選擇答案";

        correctAnswer=questiondata[x[times]*questionexcel+4];

        var answerarray=[questiondata[x[times]*questionexcel+4],questiondata[x[times]*questionexcel+5],questiondata[x[times]*questionexcel+6],questiondata[x[times]*questionexcel+7],questiondata[x[times]*questionexcel+8]];
        answerarray.sort();
        document.getElementById("answer1").innerHTML=answerarray[0];
        document.getElementById("answer2").innerHTML=answerarray[1];
        document.getElementById("answer3").innerHTML=answerarray[2];
        document.getElementById("answer4").innerHTML=answerarray[3];
        document.getElementById("answer5").innerHTML=answerarray[4];
    }
 }

</script>

</body >

</html>
