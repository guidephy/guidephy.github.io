<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ËÉΩÊ∫êÂ∞èÂ≥∂ - ÂÆàË≠∑Âè∞ÁÅ£</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --ocean: #0ea5e9;
            --ocean-dark: #0369a1;
            --land: #22c55e;
            --land-dark: #15803d;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-light: #334155;
            --text: #f1f5f9;
            --text-dim: #94a3b8;
            --gold: #fbbf24;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Noto Sans TC', -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            touch-action: manipulation;
        }

        /* === APP CONTAINER === */
        #app {
            display: flex;
            flex-direction: column;
            height: 100%;
            height: 100dvh;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        /* === TOP STATUS BAR === */
        #status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            padding: 10px 12px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 100%);
            position: relative;
            z-index: 100;
        }

        .status-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 8px 6px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .status-item .label {
            font-size: 9px;
            color: var(--text-dim);
            margin-bottom: 2px;
        }

        .status-item .value {
            font-size: 16px;
            font-weight: 900;
            font-family: monospace;
        }

        .status-item.year .value { color: var(--primary); }
        .status-item.funds .value { color: var(--gold); }
        .status-item.happy .value { color: var(--success); }
        .status-item.safety .value { color: var(--ocean); }
        .status-item.safety.danger .value { color: var(--danger); }

        /* === MAP AREA === */
        #map-area {
            flex: 1;
            position: relative;
            background: linear-gradient(180deg, #38bdf8 0%, #0ea5e9 30%, #0284c7 60%, #0369a1 100%);
            overflow: hidden;
            min-height: 0;
        }

        /* Animated waves */
        .wave-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            overflow: hidden;
        }

        .wave {
            position: absolute;
            bottom: -5px;
            left: -100%;
            width: 300%;
            height: 40px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath fill='%230369a1' d='M0,60 C300,100 600,20 900,60 C1200,100 1200,60 1200,60 L1200,120 L0,120 Z'/%3E%3C/svg%3E") repeat-x;
            background-size: 400px 40px;
            animation: wave-move 8s linear infinite;
            opacity: 0.6;
        }

        .wave:nth-child(2) {
            animation-duration: 12s;
            animation-delay: -3s;
            opacity: 0.4;
            bottom: 0;
        }

        @keyframes wave-move {
            0% { transform: translateX(0); }
            100% { transform: translateX(33.33%); }
        }

        /* Sun */
        .sun {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 45px;
            height: 45px;
            background: radial-gradient(circle, #fff 0%, #fbbf24 50%, #f59e0b 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px #fbbf24;
        }

        /* Taiwan SVG - Ê≠£Á¢∫ÊñπÂêëÔºöÊù±ÈÉ®Âú®Âè≥ÈÇä */
        #taiwan-svg {
            position: absolute;
            left: 50%;
            top: 45%;
            transform: translate(-50%, -50%);
            width: 55%;
            max-width: 200px;
            height: auto;
            filter: drop-shadow(0 8px 20px rgba(0,0,0,0.3));
        }

        .taiwan-land {
            fill: url(#landGrad);
            stroke: var(--land-dark);
            stroke-width: 2;
        }

        .mountain {
            fill: #15803d;
            opacity: 0.5;
        }

        /* Region buttons on map */
        .region-btn {
            position: absolute;
            background: rgba(0,0,0,0.7);
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 10px;
            padding: 6px 8px;
            color: white;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 48px;
            backdrop-filter: blur(4px);
        }

        .region-btn:active {
            transform: scale(0.95);
        }

        .region-btn.selected {
            border-color: var(--gold);
            background: rgba(251,191,36,0.3);
            box-shadow: 0 0 15px rgba(251,191,36,0.5);
        }

        .region-btn .r-name {
            font-size: 11px;
            margin-bottom: 2px;
        }

        .region-btn .r-icons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1px;
            font-size: 12px;
            max-width: 50px;
        }

        .region-btn .r-count {
            font-size: 9px;
            color: var(--text-dim);
            margin-top: 2px;
        }

        /* Region positions - Ê≠£Á¢∫Êñπ‰Ωç */
        #region-north { left: 50%; top: 12%; transform: translateX(-50%); }
        #region-west { left: 15%; top: 40%; }
        #region-central { left: 50%; top: 50%; transform: translateX(-50%); }
        #region-south { left: 35%; top: 78%; }
        #region-east { right: 10%; top: 45%; }

        /* === BOTTOM PANEL === */
        #bottom-panel {
            background: var(--bg-dark);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            padding-bottom: var(--safe-bottom);
        }

        /* Tab navigation */
        #tabs {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            background: transparent;
            border: none;
            color: var(--text-dim);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .tab-btn .tab-icon {
            font-size: 18px;
        }

        .tab-btn.active {
            color: var(--primary);
            background: rgba(99,102,241,0.1);
            border-bottom: 2px solid var(--primary);
        }

        /* Tab content */
        .tab-content {
            display: none;
            padding: 12px;
            max-height: 38vh;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        /* === BUILD TAB === */
        .build-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .build-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 10px 6px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .build-item:active {
            transform: scale(0.96);
        }

        .build-item.selected {
            border-color: var(--gold);
            background: rgba(251,191,36,0.15);
        }

        .build-item.disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        .build-item .b-icon {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .build-item .b-name {
            font-size: 10px;
            font-weight: 700;
            margin-bottom: 2px;
            color: var(--text);
        }

        .build-item .b-cost {
            font-size: 11px;
            color: var(--gold);
            font-weight: 700;
        }

        .build-item .b-power {
            font-size: 9px;
            color: var(--ocean);
        }

        .build-hint {
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: var(--text-dim);
            background: var(--bg-card);
            border-radius: 8px;
            margin-top: 10px;
        }

        /* === FUEL TAB === */
        .fuel-section {
            margin-bottom: 15px;
        }

        .fuel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .fuel-title {
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .fuel-stock {
            font-size: 18px;
            font-weight: 900;
            font-family: monospace;
        }

        .fuel-stock.coal { color: #a1887f; }
        .fuel-stock.gas { color: #4fc3f7; }

        .fuel-bar {
            height: 8px;
            background: var(--bg-card-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .fuel-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .fuel-bar-fill.coal { background: linear-gradient(90deg, #6d4c41, #a1887f); }
        .fuel-bar-fill.gas { background: linear-gradient(90deg, #0277bd, #4fc3f7); }
        .fuel-bar-fill.low { animation: pulse-bar 1s infinite; }

        @keyframes pulse-bar {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .fuel-days {
            font-size: 10px;
            color: var(--text-dim);
            text-align: right;
            margin-bottom: 8px;
        }

        .fuel-days.danger {
            color: var(--danger);
            font-weight: bold;
        }

        .fuel-countries {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .country-btn {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 600;
            color: white;
        }

        .country-btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        .country-btn:disabled {
            opacity: 0.4;
        }

        .country-btn .c-flag {
            font-size: 20px;
            margin-right: 10px;
        }

        .country-btn .c-name {
            flex: 1;
            text-align: left;
        }

        .country-btn .c-price {
            font-weight: 900;
            font-family: monospace;
            font-size: 14px;
        }

        .country-btn .c-trend {
            margin-left: 6px;
            font-size: 12px;
        }

        .country-btn.au { background: linear-gradient(135deg, #1565c0, #1e88e5); }
        .country-btn.id { background: linear-gradient(135deg, #c62828, #e53935); }
        .country-btn.ru { background: linear-gradient(135deg, #37474f, #546e7a); }
        .country-btn.qa { background: linear-gradient(135deg, #6a1b9a, #8e24aa); }
        .country-btn.us { background: linear-gradient(135deg, #0d47a1, #1976d2); }

        .gas-locked {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            color: var(--warning);
            font-size: 12px;
        }

        /* === INFO TAB === */
        .info-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .info-card-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-dim);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .power-display {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 80px;
            padding: 0 20px;
        }

        .power-col {
            text-align: center;
            width: 60px;
        }

        .power-bar-outer {
            width: 40px;
            height: 60px;
            background: var(--bg-card-light);
            border-radius: 6px;
            margin: 0 auto 6px;
            position: relative;
            overflow: hidden;
        }

        .power-bar-inner {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-radius: 6px;
            transition: height 0.3s;
        }

        .power-bar-inner.supply { background: linear-gradient(0deg, #0ea5e9, #38bdf8); }
        .power-bar-inner.demand { background: linear-gradient(0deg, #dc2626, #f87171); }

        .power-label {
            font-size: 10px;
            color: var(--text-dim);
        }

        .power-value {
            font-size: 14px;
            font-weight: 900;
        }

        .import-display {
            text-align: center;
        }

        .import-ships {
            font-size: 20px;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .import-ships .ship {
            opacity: 0.2;
            transition: opacity 0.3s;
        }

        .import-ships .ship.active {
            opacity: 1;
        }

        .import-percent {
            font-size: 28px;
            font-weight: 900;
            color: var(--warning);
        }

        .import-hint {
            font-size: 10px;
            color: var(--text-dim);
        }

        .mission-box {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-radius: 12px;
            padding: 12px;
        }

        .mission-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--gold);
        }

        .mission-desc {
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 10px;
        }

        .mission-goal {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 4px;
            font-size: 11px;
        }

        .mission-goal.done {
            background: rgba(34,197,94,0.3);
        }

        /* === NEXT TURN BUTTON === */
        #next-btn {
            position: absolute;
            bottom: 12px;
            right: 12px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899, #db2777);
            border: none;
            color: white;
            font-size: 11px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(236,72,153,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            transition: all 0.2s;
        }

        #next-btn:active {
            transform: scale(0.95);
        }

        #next-btn .btn-icon {
            font-size: 24px;
            margin-bottom: 2px;
        }

        /* === POPUPS === */
        .popup-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .popup-overlay.show {
            display: flex;
        }

        .popup-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            max-width: 340px;
            width: 100%;
            text-align: center;
            animation: popup-in 0.3s ease;
        }

        @keyframes popup-in {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .popup-badge {
            display: inline-block;
            background: var(--primary);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .popup-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .popup-title {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 8px;
        }

        .popup-desc {
            font-size: 13px;
            color: var(--text-dim);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .popup-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 12px;
        }

        .popup-stat {
            text-align: center;
        }

        .popup-stat-value {
            font-size: 22px;
            font-weight: 900;
            color: var(--ocean);
        }

        .popup-stat-label {
            font-size: 10px;
            color: var(--text-dim);
        }

        .popup-effects {
            background: var(--bg-dark);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .popup-effect {
            padding: 5px 0;
            font-size: 13px;
        }

        .popup-effect.bad { color: var(--danger); }
        .popup-effect.good { color: var(--success); }

        .popup-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .popup-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .popup-btn:active {
            transform: scale(0.98);
        }

        /* Game Over */
        .gameover-score {
            font-size: 60px;
            font-weight: 900;
            color: var(--gold);
            margin: 15px 0;
        }

        /* === FLOAT TEXT === */
        .float-text {
            position: fixed;
            font-weight: 900;
            font-size: 16px;
            pointer-events: none;
            z-index: 500;
            animation: float-up 1s ease-out forwards;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .float-text.good { color: var(--success); }
        .float-text.bad { color: var(--danger); }
        .float-text.gold { color: var(--gold); }

        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }

        /* === SCROLLBAR === */
        .tab-content::-webkit-scrollbar {
            width: 4px;
        }

        .tab-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .tab-content::-webkit-scrollbar-thumb {
            background: var(--bg-card-light);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Status Bar -->
        <div id="status-bar">
            <div class="status-item year">
                <div class="label">Ë•øÂÖÉ</div>
                <div class="value" id="s-year">1975</div>
            </div>
            <div class="status-item funds">
                <div class="label">Ë≥áÈáë(ÂÑÑ)</div>
                <div class="value" id="s-funds">2500</div>
            </div>
            <div class="status-item happy">
                <div class="label">ÊªøÊÑèÂ∫¶</div>
                <div class="value" id="s-happy">100</div>
            </div>
            <div class="status-item safety" id="safety-item">
                <div class="label">ÂÆâÂÖ®Â≠òÈáè</div>
                <div class="value" id="s-safety">25Â§©</div>
            </div>
        </div>

        <!-- Map Area -->
        <div id="map-area">
            <div class="sun"></div>
            <div class="wave-container">
                <div class="wave"></div>
                <div class="wave"></div>
            </div>

            <!-- Taiwan SVG - Ê≠£Á¢∫ÊñπÂêë -->
            <svg id="taiwan-svg" viewBox="0 0 200 320">
                <defs>
                    <linearGradient id="landGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#4ade80"/>
                        <stop offset="100%" stop-color="#22c55e"/>
                    </linearGradient>
                </defs>
                <!-- Âè∞ÁÅ£Êú¨Â≥∂ - Êù±ÈÇä(Âè≥)ÊòØÈô°Â≥≠Êµ∑Â≤∏ÔºåË•øÈÇä(Â∑¶)ÊòØÂπ≥Á∑© -->
                <path class="taiwan-land" d="
                    M 100 15
                    C 115 18, 130 28, 142 45
                    C 155 65, 165 90, 170 120
                    C 175 150, 175 180, 170 210
                    C 165 240, 152 270, 135 290
                    C 120 305, 100 310, 85 305
                    C 65 298, 50 275, 40 245
                    C 30 215, 28 180, 30 145
                    C 32 110, 42 75, 58 50
                    C 74 28, 88 15, 100 15
                    Z
                "/>
                <!-- ‰∏≠Â§ÆÂ±±ËÑà - ÂÅèÊù±ÂÅ¥ -->
                <path class="mountain" d="M 95 60 L 115 30 L 135 60 L 120 70 L 140 100 L 115 80 L 95 100 L 105 70 Z"/>
                <path class="mountain" d="M 90 120 L 115 75 L 140 120 L 125 135 L 145 175 L 115 145 L 90 175 L 100 135 Z"/>
                <path class="mountain" d="M 88 200 L 115 150 L 142 200 L 125 220 L 135 260 L 115 235 L 95 260 L 105 220 Z"/>
            </svg>

            <!-- Region Buttons - Ê≠£Á¢∫Êñπ‰Ωç -->
            <div class="region-btn" id="region-north">
                <div class="r-name">ÂåóÈÉ®</div>
                <div class="r-icons" id="icons-north"></div>
                <div class="r-count" id="count-north">0Â∫ß</div>
            </div>
            <div class="region-btn" id="region-west">
                <div class="r-name">Ë•øÈÉ®</div>
                <div class="r-icons" id="icons-west"></div>
                <div class="r-count" id="count-west">0Â∫ß</div>
            </div>
            <div class="region-btn" id="region-central">
                <div class="r-name">‰∏≠ÈÉ®</div>
                <div class="r-icons" id="icons-central"></div>
                <div class="r-count" id="count-central">0Â∫ß</div>
            </div>
            <div class="region-btn" id="region-south">
                <div class="r-name">ÂçóÈÉ®</div>
                <div class="r-icons" id="icons-south"></div>
                <div class="r-count" id="count-south">0Â∫ß</div>
            </div>
            <div class="region-btn" id="region-east">
                <div class="r-name">Êù±ÈÉ®</div>
                <div class="r-icons" id="icons-east"></div>
                <div class="r-count" id="count-east">0Â∫ß</div>
            </div>

            <!-- Next Turn Button -->
            <button id="next-btn" onclick="game.nextTurn()">
                <span class="btn-icon">üåÖ</span>
                <span>‰∏ã‰∏ÄÂπ¥</span>
            </button>
        </div>

        <!-- Bottom Panel -->
        <div id="bottom-panel">
            <!-- Tabs -->
            <div id="tabs">
                <button class="tab-btn active" onclick="switchTab('build')">
                    <span class="tab-icon">üèóÔ∏è</span>
                    <span>Âª∫Ë®≠</span>
                </button>
                <button class="tab-btn" onclick="switchTab('fuel')">
                    <span class="tab-icon">‚õΩ</span>
                    <span>ÁáÉÊñô</span>
                </button>
                <button class="tab-btn" onclick="switchTab('info')">
                    <span class="tab-icon">üìä</span>
                    <span>Ë≥áË®ä</span>
                </button>
            </div>

            <!-- Build Tab -->
            <div class="tab-content active" id="tab-build">
                <div class="build-grid" id="build-grid"></div>
                <div class="build-hint" id="build-hint">üí° ÈÅ∏ÊìáË®≠ÊñΩÂæåÔºåÈªûÊìäÂú∞Âúñ‰∏äÁöÑÂçÄÂüüÂª∫Ë®≠</div>
            </div>

            <!-- Fuel Tab -->
            <div class="tab-content" id="tab-fuel">
                <!-- Coal -->
                <div class="fuel-section">
                    <div class="fuel-header">
                        <div class="fuel-title">ü™® ÁÖ§ÁÇ≠</div>
                        <div class="fuel-stock coal" id="coal-stock">500</div>
                    </div>
                    <div class="fuel-bar">
                        <div class="fuel-bar-fill coal" id="coal-bar" style="width:50%"></div>
                    </div>
                    <div class="fuel-days" id="coal-days">ÂèØÁî® 25 Â§©</div>
                    <div class="fuel-countries" id="coal-countries"></div>
                </div>

                <!-- Gas -->
                <div class="fuel-section">
                    <div class="fuel-header">
                        <div class="fuel-title">üî• Â§©ÁÑ∂Ê∞£</div>
                        <div class="fuel-stock gas" id="gas-stock">0</div>
                    </div>
                    <div class="fuel-bar">
                        <div class="fuel-bar-fill gas" id="gas-bar" style="width:0%"></div>
                    </div>
                    <div class="fuel-days" id="gas-days">ÈúÄÂª∫Êé•Êî∂Á´ô</div>
                    <div id="gas-countries-wrapper"></div>
                </div>
            </div>

            <!-- Info Tab -->
            <div class="tab-content" id="tab-info">
                <div class="info-card">
                    <div class="info-card-title">‚ö° ÈõªÂäõ‰æõÈúÄ</div>
                    <div class="power-display">
                        <div class="power-col">
                            <div class="power-bar-outer">
                                <div class="power-bar-inner supply" id="pw-supply" style="height:30%"></div>
                            </div>
                            <div class="power-label">‰æõÁµ¶</div>
                            <div class="power-value" id="pw-supply-val">160</div>
                        </div>
                        <div class="power-col">
                            <div class="power-bar-outer">
                                <div class="power-bar-inner demand" id="pw-demand" style="height:50%"></div>
                            </div>
                            <div class="power-label">ÈúÄÊ±Ç</div>
                            <div class="power-value" id="pw-demand-val">600</div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-title">üö¢ ÈÄ≤Âè£‰æùË≥¥Â∫¶</div>
                    <div class="import-display">
                        <div class="import-ships" id="import-ships">
                            <span class="ship active">üö¢</span>
                            <span class="ship active">üö¢</span>
                            <span class="ship active">üö¢</span>
                            <span class="ship active">üö¢</span>
                            <span class="ship">üö¢</span>
                        </div>
                        <div class="import-percent" id="import-pct">98%</div>
                        <div class="import-hint">ÁôºÂ±ïÁ∂†ËÉΩÂèØÈôç‰ΩéÈ¢®Èö™</div>
                    </div>
                </div>

                <div class="mission-box">
                    <div class="mission-title" id="m-title">üéØ Âü∫Á§éÂª∫Ë®≠Êúü</div>
                    <div class="mission-desc" id="m-desc">Á∂ìÊøüËµ∑È£õÈúÄË¶ÅÈõªÂäõÔºÅ</div>
                    <div id="m-goals"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Popup -->
    <div class="popup-overlay" id="event-popup">
        <div class="popup-card">
            <div class="popup-badge" id="evt-year">1975Âπ¥</div>
            <div class="popup-icon" id="evt-icon">üõ¢Ô∏è</div>
            <div class="popup-title" id="evt-title">‰∫ã‰ª∂</div>
            <div class="popup-desc" id="evt-desc">ÊèèËø∞</div>
            <div class="popup-stats">
                <div class="popup-stat">
                    <div class="popup-stat-value" id="evt-income">+0</div>
                    <div class="popup-stat-label">ÁáüÊî∂</div>
                </div>
                <div class="popup-stat">
                    <div class="popup-stat-value" id="evt-power">0</div>
                    <div class="popup-stat-label">ÁôºÈõª</div>
                </div>
            </div>
            <div class="popup-effects" id="evt-effects"></div>
            <button class="popup-btn primary" onclick="game.closeEvent()">ÁπºÁ∫å</button>
        </div>
    </div>

    <!-- Game Over Popup -->
    <div class="popup-overlay" id="gameover-popup">
        <div class="popup-card">
            <div class="popup-icon" id="go-icon">üèÜ</div>
            <div class="popup-title" id="go-title">ÈÅäÊà≤ÁµêÊùü</div>
            <div class="popup-desc" id="go-desc">ÊèèËø∞</div>
            <div class="gameover-score" id="go-score">0</div>
            <button class="popup-btn primary" onclick="location.reload()">üîÑ ÂÜçÁé©‰∏ÄÊ¨°</button>
        </div>
    </div>

    <script>
    // === CONFIG ===
    const PLANTS = {
        coal:     { name: 'ÁáÉÁÖ§', emoji: 'üè≠', cost: 500,  output: 80,  fuelUse: 20, fuel: 'coal' },
        gas:      { name: 'ÁáÉÊ∞£', emoji: 'üî•', cost: 800,  output: 100, fuelUse: 15, fuel: 'gas' },
        nuclear:  { name: 'Ê†∏ËÉΩ', emoji: '‚öõÔ∏è', cost: 2500, output: 280, fuelUse: 0,  fuel: null },
        wind:     { name: 'È¢®Èõª', emoji: 'üå¨Ô∏è', cost: 1200, output: 35,  fuelUse: 0,  fuel: null },
        solar:    { name: 'Â§™ÈôΩËÉΩ', emoji: '‚òÄÔ∏è', cost: 600,  output: 25,  fuelUse: 0,  fuel: null },
        terminal: { name: 'Êé•Êî∂Á´ô', emoji: 'üèóÔ∏è', cost: 1000, output: 0,   fuelUse: 0,  fuel: null }
    };

    const FUEL_SOURCES = {
        coal: [
            { id: 'au', name: 'Êæ≥Ê¥≤', flag: 'üá¶üá∫', base: 200, css: 'au' },
            { id: 'id', name: 'Âç∞Â∞º', flag: 'üáÆüá©', base: 150, css: 'id' },
            { id: 'ru', name: '‰øÑÁæÖÊñØ', flag: 'üá∑üá∫', base: 180, css: 'ru' }
        ],
        gas: [
            { id: 'qa', name: 'Âç°ÈÅî', flag: 'üá∂üá¶', base: 350, css: 'qa' },
            { id: 'au', name: 'Êæ≥Ê¥≤', flag: 'üá¶üá∫', base: 380, css: 'au' },
            { id: 'us', name: 'ÁæéÂúã', flag: 'üá∫üá∏', base: 420, css: 'us' }
        ]
    };

    const REGIONS = ['north', 'west', 'central', 'south', 'east'];

    const SCENARIOS = [
        { start: 1975, end: 1990, title: 'üéØ Âü∫Á§éÂª∫Ë®≠Êúü', desc: 'Á∂ìÊøüËµ∑È£õÈúÄË¶ÅÈõªÂäõÔºÅ', goals: [
            { text: 'ÁôºÈõª ‚â• 800 MW', check: g => g.output >= 800 },
            { text: 'Ë≥áÈáë ‚â• 5000 ÂÑÑ', check: g => g.funds >= 5000 }
        ]},
        { start: 1991, end: 2005, title: 'üéØ Á∂ìÊøüÂ•áËπü', desc: 'Á©©ÂÆö‰æõÈõªÊîØÊíêÁßëÊäÄÊ•≠', goals: [
            { text: 'ÁôºÈõª ‚â• 1500 MW', check: g => g.output >= 1500 },
            { text: 'ÊªøÊÑèÂ∫¶ > 85', check: g => g.satisfaction > 85 }
        ]},
        { start: 2006, end: 2020, title: 'üéØ ËÉΩÊ∫êËΩâÂûã', desc: 'Ê∏õÁ¢≥ËàáÂ§öÂÖÉËÉΩÊ∫ê', goals: [
            { text: 'ÁáÉÊ∞£ÈõªÂª† ‚â• 2', check: g => g.counts.gas >= 2 },
            { text: 'Êé•Êî∂Á´ô ‚â• 1', check: g => g.counts.terminal >= 1 }
        ]},
        { start: 2021, end: 2025, title: 'üéØ ËÉΩÊ∫êÂÆâÂÖ®', desc: 'ËøΩÊ±ÇËá™‰∏ªÈôç‰ΩéÈ¢®Èö™', goals: [
            { text: 'ÂÆâÂÖ®Â≠òÈáè ‚â• 14Â§©', check: g => g.safetyDays >= 14 },
            { text: 'ÈÄ≤Âè£‰æùË≥¥ < 85%', check: g => g.importDep < 85 }
        ]}
    ];

    const EVENTS = {
        early: [
            { icon: 'üõ¢Ô∏è', title: 'Áü≥Ê≤πÂç±Ê©ü', desc: '‰∏≠Êù±Êà∞Áà≠Ê≤πÂÉπÊö¥Êº≤', fx: [{ t: 'priceUp', v: 1.5, txt: 'ÁáÉÊñôÊº≤ 50%', bad: 1 }] },
            { icon: 'üèóÔ∏è', title: 'ÂçÅÂ§ßÂª∫Ë®≠', desc: 'ÊîøÂ∫úË£úÂä©ÈáçÂ∑•Ê•≠', fx: [{ t: 'funds', v: 800, txt: '+800 ÂÑÑ', bad: 0 }] },
            { icon: 'üí∞', title: 'Á∂ìÊøüËµ∑È£õ', desc: 'Âá∫Âè£Êö¢Êó∫', fx: [{ t: 'funds', v: 1000, txt: '+1000 ÂÑÑ', bad: 0 }] },
            { icon: 'üîå', title: 'Áî®ÈõªÊàêÈï∑', desc: 'ÂÆ∂ÈõªÊôÆÂèä', fx: [{ t: 'demand', v: 80, txt: 'ÈúÄÊ±Ç +80', bad: 1 }] },
            { icon: 'üå§Ô∏è', title: 'È¢®Ë™øÈõ®È†Ü', desc: 'Âπ≥Á©©ÁöÑ‰∏ÄÂπ¥', fx: [{ t: 'happy', v: 5, txt: 'ÊªøÊÑèÂ∫¶ +5', bad: 0 }] }
        ],
        mid: [
            { icon: 'üèöÔ∏è', title: '921Âú∞Èúá', desc: 'ÈõªÁ∂≤Âö¥ÈáçÂèóÊêç', fx: [{ t: 'funds', v: -600, txt: '-600 ÂÑÑ', bad: 1 }, { t: 'happy', v: -10, txt: 'ÊªøÊÑèÂ∫¶ -10', bad: 1 }] },
            { icon: 'üíª', title: 'ÁßëÊäÄÊ•≠Êì¥Âºµ', desc: 'Êô∂ÂúìÂª†Ë®≠Á´ã', fx: [{ t: 'demand', v: 200, txt: 'ÈúÄÊ±Ç +200', bad: 1 }, { t: 'income', v: 1.15, txt: 'ÁáüÊî∂ +15%', bad: 0 }] },
            { icon: 'üìâ', title: 'ÈáëËûçÊµ∑ÂòØ', desc: 'Á∂ìÊøüË°∞ÈÄÄ', fx: [{ t: 'demand', v: -100, txt: 'ÈúÄÊ±Ç -100', bad: 0 }] },
            { icon: 'üåç', title: '‰∫¨ÈÉΩË≠∞ÂÆöÊõ∏', desc: 'Á¢≥ÊéíÊîæÈóúÊ≥®', fx: [{ t: 'co2', v: 1, txt: 'È´òÁ¢≥ÊéíÊâ£ÂàÜ', bad: 1 }] }
        ],
        late: [
            { icon: 'üáØüáµ', title: 'Á¶èÂ≥∂Ê†∏ÁÅΩ', desc: 'ÂèçÊ†∏ËÅ≤Êµ™', fx: [{ t: 'funds', v: -400, txt: '-400 ÂÑÑ', bad: 1 }] },
            { icon: 'üí°', title: '815ÂÅúÈõª', desc: 'ÂÖ®Âè∞Â§ßË∑≥Èõª', fx: [{ t: 'happy', v: -15, txt: 'ÊªøÊÑèÂ∫¶ -15', bad: 1 }] },
            { icon: 'üá∫üá¶', title: 'ÁÉè‰øÑÊà∞Áà≠', desc: 'Â§©ÁÑ∂Ê∞£È£ÜÊº≤', fx: [{ t: 'gasPrice', v: 2, txt: 'Ê∞£ÂÉπ x2', bad: 1 }] },
            { icon: 'ü§ñ', title: 'AIÁÜ±ÊΩÆ', desc: 'ÁÆóÂäõÈúÄÊ±ÇÊö¥Â¢û', fx: [{ t: 'demand', v: 250, txt: 'ÈúÄÊ±Ç +250', bad: 1 }, { t: 'income', v: 1.2, txt: 'ÁáüÊî∂ +20%', bad: 0 }] },
            { icon: 'üö¢', title: 'Êµ∑Â≥ΩÂ∞ÅÈéñ', desc: 'ËàπÈöªÁÑ°Ê≥ïÂÖ•Ê∏Ø', fx: [{ t: 'blockade', v: 1, txt: '‚ö†Ô∏è ÁÑ°Ê≥ïÈÄ≤Âè£', bad: 1 }] },
            { icon: '‚òÄÔ∏è', title: 'Á∂†ËÉΩË£úÂä©', desc: 'Â§™ÈôΩËÉΩÈôçÂÉπ', fx: [{ t: 'solarCost', v: -150, txt: 'Â§™ÈôΩËÉΩ -150', bad: 0 }] }
        ]
    };

    // === GAME STATE ===
    const game = {
        year: 1975,
        funds: 2500,
        satisfaction: 100,
        baseDemand: 600,
        fuel: { coal: 500, gas: 0 },
        price: { coal: 1, gas: 1 },
        counts: { coal: 0, gas: 0, nuclear: 0, wind: 0, solar: 0, terminal: 0 },
        regions: { north: [], west: [], central: [], south: [], east: [] },
        output: 0,
        safetyDays: 25,
        importDep: 98,
        incomeMult: 1,
        co2Tax: false,
        blockade: false,
        selected: null,

        init() {
            this.regions.north.push('coal');
            this.regions.west.push('coal');
            this.counts.coal = 2;
            this.output = 160;

            this.renderBuildGrid();
            this.renderFuelCountries();
            this.setupRegions();
            this.updateUI();
        },

        renderBuildGrid() {
            const grid = document.getElementById('build-grid');
            grid.innerHTML = '';
            Object.entries(PLANTS).forEach(([type, p]) => {
                const div = document.createElement('div');
                div.className = 'build-item';
                div.dataset.type = type;
                div.innerHTML = `
                    <div class="b-icon">${p.emoji}</div>
                    <div class="b-name">${p.name}</div>
                    <div class="b-cost">$${p.cost}</div>
                    <div class="b-power">${p.output > 0 ? '‚ö°' + p.output : 'üì¶+500'}</div>
                `;
                div.onclick = () => this.selectBuild(type);
                grid.appendChild(div);
            });
        },

        renderFuelCountries() {
            // Coal
            const coalDiv = document.getElementById('coal-countries');
            coalDiv.innerHTML = '';
            FUEL_SOURCES.coal.forEach(s => {
                const btn = document.createElement('button');
                btn.className = `country-btn ${s.css}`;
                btn.id = `fuel-coal-${s.id}`;
                btn.onclick = () => this.buyFuel('coal', s);
                coalDiv.appendChild(btn);
            });

            // Gas wrapper
            const gasWrapper = document.getElementById('gas-countries-wrapper');
            gasWrapper.innerHTML = `
                <div class="fuel-countries" id="gas-countries"></div>
                <div class="gas-locked" id="gas-locked">‚ö†Ô∏è ÈúÄÂÖàÂª∫ÈÄ† LNG Êé•Êî∂Á´ô</div>
            `;
            const gasDiv = document.getElementById('gas-countries');
            FUEL_SOURCES.gas.forEach(s => {
                const btn = document.createElement('button');
                btn.className = `country-btn ${s.css}`;
                btn.id = `fuel-gas-${s.id}`;
                btn.onclick = () => this.buyFuel('gas', s);
                gasDiv.appendChild(btn);
            });

            this.updateFuelPrices();
        },

        updateFuelPrices() {
            FUEL_SOURCES.coal.forEach(s => {
                const btn = document.getElementById(`fuel-coal-${s.id}`);
                const price = Math.floor(s.base * this.price.coal);
                const trend = this.price.coal > 1.2 ? 'üìà' : this.price.coal < 0.9 ? 'üìâ' : '';
                btn.innerHTML = `
                    <span class="c-flag">${s.flag}</span>
                    <span class="c-name">${s.name}</span>
                    <span class="c-price">$${price}</span>
                    <span class="c-trend">${trend}</span>
                `;
                btn.disabled = this.blockade || this.funds < price;
            });

            FUEL_SOURCES.gas.forEach(s => {
                const btn = document.getElementById(`fuel-gas-${s.id}`);
                const price = Math.floor(s.base * this.price.gas);
                const trend = this.price.gas > 1.2 ? 'üìà' : this.price.gas < 0.9 ? 'üìâ' : '';
                btn.innerHTML = `
                    <span class="c-flag">${s.flag}</span>
                    <span class="c-name">${s.name}</span>
                    <span class="c-price">$${price}</span>
                    <span class="c-trend">${trend}</span>
                `;
                btn.disabled = this.blockade || this.funds < price || this.counts.terminal === 0;
            });

            document.getElementById('gas-countries').style.display = this.counts.terminal > 0 ? 'flex' : 'none';
            document.getElementById('gas-locked').style.display = this.counts.terminal > 0 ? 'none' : 'block';
        },

        setupRegions() {
            REGIONS.forEach(r => {
                document.getElementById(`region-${r}`).onclick = () => this.buildAt(r);
            });
        },

        selectBuild(type) {
            const p = PLANTS[type];
            if (this.funds < p.cost) {
                this.float(window.innerWidth / 2, window.innerHeight / 2, 'Ë≥áÈáë‰∏çË∂≥', 'bad');
                return;
            }
            if (type === 'gas' && this.counts.terminal === 0) {
                this.float(window.innerWidth / 2, window.innerHeight / 2, 'ÈúÄÂÖàÂª∫Êé•Êî∂Á´ô', 'bad');
                return;
            }

            this.selected = this.selected === type ? null : type;

            document.querySelectorAll('.build-item').forEach(el => {
                el.classList.toggle('selected', el.dataset.type === this.selected);
            });
            REGIONS.forEach(r => {
                document.getElementById(`region-${r}`).classList.toggle('selected', !!this.selected);
            });

            document.getElementById('build-hint').textContent = this.selected
                ? `üî® ÈªûÊìäÂú∞ÂúñÂçÄÂüüÂª∫Ë®≠ ${p.name}`
                : 'üí° ÈÅ∏ÊìáË®≠ÊñΩÂæåÔºåÈªûÊìäÂú∞Âúñ‰∏äÁöÑÂçÄÂüüÂª∫Ë®≠';
        },

        buildAt(region) {
            if (!this.selected) {
                this.float(window.innerWidth / 2, window.innerHeight / 3, 'Ë´ãÂÖàÈÅ∏ÊìáË®≠ÊñΩ', 'bad');
                return;
            }

            const type = this.selected;
            const p = PLANTS[type];

            this.funds -= p.cost;
            this.regions[region].push(type);
            this.counts[type]++;

            const el = document.getElementById(`region-${region}`);
            const rect = el.getBoundingClientRect();
            this.float(rect.left + rect.width / 2, rect.top, `-${p.cost}`, 'gold');

            this.selected = null;
            document.querySelectorAll('.build-item').forEach(el => el.classList.remove('selected'));
            REGIONS.forEach(r => document.getElementById(`region-${r}`).classList.remove('selected'));
            document.getElementById('build-hint').textContent = 'üí° ÈÅ∏ÊìáË®≠ÊñΩÂæåÔºåÈªûÊìäÂú∞Âúñ‰∏äÁöÑÂçÄÂüüÂª∫Ë®≠';

            this.updateUI();
        },

        buyFuel(type, source) {
            if (this.blockade) {
                this.float(window.innerWidth / 2, 150, 'Â∞ÅÈéñ‰∏≠ÔºÅ', 'bad');
                return;
            }

            const amount = 100;
            const price = Math.floor(source.base * this.price[type]);

            if (type === 'gas') {
                const cap = this.counts.terminal * 500;
                if (this.fuel.gas + amount > cap) {
                    this.float(window.innerWidth / 2, 150, 'ÂÑ≤ÊßΩÂ∑≤Êªø', 'bad');
                    return;
                }
            }

            if (this.funds < price) {
                this.float(window.innerWidth / 2, 150, 'Ë≥áÈáë‰∏çË∂≥', 'bad');
                return;
            }

            this.funds -= price;
            this.fuel[type] += amount;
            this.float(window.innerWidth / 2, 120, `${source.flag} +100`, 'good');
            this.updateUI();
        },

        nextTurn() {
            const coalUse = this.counts.coal * PLANTS.coal.fuelUse;
            const gasUse = this.counts.gas * PLANTS.gas.fuelUse;

            let power = 0;
            power += this.counts.nuclear * PLANTS.nuclear.output;
            power += this.counts.wind * PLANTS.wind.output;
            power += this.counts.solar * PLANTS.solar.output;

            if (coalUse > 0) {
                const ratio = Math.min(1, this.fuel.coal / coalUse);
                power += this.counts.coal * PLANTS.coal.output * ratio;
            }
            if (gasUse > 0) {
                const ratio = Math.min(1, this.fuel.gas / gasUse);
                power += this.counts.gas * PLANTS.gas.output * ratio;
            }
            power = Math.floor(power);

            this.fuel.coal = Math.max(0, this.fuel.coal - coalUse);
            this.fuel.gas = Math.max(0, this.fuel.gas - gasUse);

            let income = Math.floor(Math.min(power, this.baseDemand) * 2.5 * this.incomeMult);

            if (power < this.baseDemand) {
                const penalty = Math.ceil((this.baseDemand - power) / 30);
                this.satisfaction -= penalty;
            } else {
                this.satisfaction = Math.min(100, this.satisfaction + 2);
            }

            if (this.co2Tax && (this.counts.coal * 12 + this.counts.gas * 6) > 40) {
                this.satisfaction -= 3;
            }

            this.funds += income;

            this.price.coal = Math.max(0.7, Math.min(2, this.price.coal * (0.85 + Math.random() * 0.3)));
            this.price.gas = Math.max(0.7, Math.min(2.5, this.price.gas * (0.85 + Math.random() * 0.3)));

            let pool = this.year < 1991 ? EVENTS.early : this.year < 2006 ? EVENTS.mid : EVENTS.late;
            const evt = pool[Math.floor(Math.random() * pool.length)];

            this.blockade = false;

            evt.fx.forEach(f => {
                switch (f.t) {
                    case 'funds': this.funds += f.v; break;
                    case 'demand': this.baseDemand = Math.max(200, this.baseDemand + f.v); break;
                    case 'happy': this.satisfaction = Math.max(0, Math.min(100, this.satisfaction + f.v)); break;
                    case 'priceUp': this.price.coal *= f.v; this.price.gas *= f.v; break;
                    case 'gasPrice': this.price.gas *= f.v; break;
                    case 'income': this.incomeMult *= f.v; break;
                    case 'co2': this.co2Tax = true; break;
                    case 'blockade': this.blockade = true; break;
                    case 'solarCost': PLANTS.solar.cost = Math.max(200, PLANTS.solar.cost + f.v); break;
                }
            });

            this.showEvent(evt, income, power);

            this.year++;
            this.baseDemand += 30;

            if (this.satisfaction <= 0) {
                setTimeout(() => this.gameOver(false, 'Ê∞ëÁúæÊªøÊÑèÂ∫¶Ê≠∏Èõ∂'), 300);
            } else if (this.year > 2025) {
                setTimeout(() => this.gameOver(true, 'ÂÆåÊàê50Âπ¥ÊåëÊà∞ÔºÅ'), 300);
            }

            this.updateUI();
        },

        showEvent(evt, income, power) {
            document.getElementById('evt-year').textContent = this.year + 'Âπ¥';
            document.getElementById('evt-icon').textContent = evt.icon;
            document.getElementById('evt-title').textContent = evt.title;
            document.getElementById('evt-desc').textContent = evt.desc;
            document.getElementById('evt-income').textContent = '+' + income;
            document.getElementById('evt-power').textContent = power;
            document.getElementById('evt-effects').innerHTML = evt.fx.map(f =>
                `<div class="popup-effect ${f.bad ? 'bad' : 'good'}">${f.bad ? 'üìâ' : 'üìà'} ${f.txt}</div>`
            ).join('');
            document.getElementById('event-popup').classList.add('show');
        },

        closeEvent() {
            document.getElementById('event-popup').classList.remove('show');
        },

        gameOver(win, reason) {
            const score = Math.floor(this.satisfaction * 10 + this.funds / 20 + (100 - this.importDep) * 3 + this.output / 5);
            document.getElementById('go-icon').textContent = win ? 'üèÜ' : 'üò¢';
            document.getElementById('go-title').textContent = win ? '‰ªªÂãôÂÆåÊàêÔºÅ' : 'ÈÅäÊà≤ÁµêÊùü';
            document.getElementById('go-desc').textContent = reason;
            document.getElementById('go-score').textContent = score;
            document.getElementById('gameover-popup').classList.add('show');
        },

        updateUI() {
            let output = 0, renewable = 0;
            Object.entries(this.counts).forEach(([t, n]) => {
                if (t === 'terminal') return;
                output += n * PLANTS[t].output;
                if (t === 'wind' || t === 'solar') renewable += n * PLANTS[t].output;
            });
            this.output = output;
            this.importDep = output > 0 ? Math.round(((output - renewable) / output) * 100) : 98;

            const coalDaily = this.counts.coal * PLANTS.coal.fuelUse;
            const gasDaily = this.counts.gas * PLANTS.gas.fuelUse;
            let coalDays = coalDaily > 0 ? Math.floor(this.fuel.coal / coalDaily) : 999;
            let gasDays = gasDaily > 0 ? Math.floor(this.fuel.gas / gasDaily) : (this.counts.gas > 0 ? 0 : 999);
            this.safetyDays = Math.min(coalDays, gasDays, 99);

            // Status bar
            document.getElementById('s-year').textContent = this.year;
            document.getElementById('s-funds').textContent = this.funds;
            document.getElementById('s-happy').textContent = this.satisfaction;
            document.getElementById('s-safety').textContent = this.safetyDays + 'Â§©';
            document.getElementById('safety-item').classList.toggle('danger', this.safetyDays < 14);

            // Fuel
            document.getElementById('coal-stock').textContent = Math.floor(this.fuel.coal);
            document.getElementById('coal-bar').style.width = Math.min(100, this.fuel.coal / 10) + '%';
            document.getElementById('coal-days').textContent = coalDaily > 0 ? `ÂèØÁî® ${coalDays} Â§©` : 'ÁÑ°Ê∂àËÄó';
            document.getElementById('coal-days').classList.toggle('danger', coalDays < 14 && coalDaily > 0);

            const gasCap = this.counts.terminal * 500;
            document.getElementById('gas-stock').textContent = Math.floor(this.fuel.gas);
            document.getElementById('gas-bar').style.width = gasCap > 0 ? Math.min(100, (this.fuel.gas / gasCap) * 100) + '%' : '0%';
            document.getElementById('gas-days').textContent = this.counts.terminal === 0 ? 'ÈúÄÂª∫Êé•Êî∂Á´ô' : (gasDaily > 0 ? `ÂèØÁî® ${gasDays} Â§©` : 'ÁÑ°Ê∂àËÄó');
            document.getElementById('gas-days').classList.toggle('danger', gasDays < 14 && gasDaily > 0);

            this.updateFuelPrices();

            // Power
            const maxP = Math.max(this.baseDemand, output) * 1.3;
            document.getElementById('pw-supply').style.height = (output / maxP * 100) + '%';
            document.getElementById('pw-demand').style.height = (this.baseDemand / maxP * 100) + '%';
            document.getElementById('pw-supply-val').textContent = output;
            document.getElementById('pw-demand-val').textContent = this.baseDemand;

            // Import
            document.getElementById('import-pct').textContent = this.importDep + '%';
            const ships = document.querySelectorAll('#import-ships .ship');
            const activeShips = Math.ceil(this.importDep / 20);
            ships.forEach((s, i) => s.classList.toggle('active', i < activeShips));

            // Mission
            const scenario = SCENARIOS.find(s => this.year >= s.start && this.year <= s.end) || SCENARIOS[3];
            document.getElementById('m-title').textContent = scenario.title;
            document.getElementById('m-desc').textContent = scenario.desc;
            document.getElementById('m-goals').innerHTML = scenario.goals.map(g =>
                `<div class="mission-goal ${g.check(this) ? 'done' : ''}">${g.check(this) ? '‚úÖ' : '‚¨ú'} ${g.text}</div>`
            ).join('');

            // Regions
            REGIONS.forEach(r => {
                const plants = this.regions[r];
                document.getElementById(`icons-${r}`).innerHTML = plants.slice(-3).map(t => PLANTS[t].emoji).join('');
                document.getElementById(`count-${r}`).textContent = plants.length > 0 ? `${plants.length}Â∫ß` : 'Á©∫';
            });

            // Build items
            document.querySelectorAll('.build-item').forEach(el => {
                const t = el.dataset.type;
                const p = PLANTS[t];
                const disabled = this.funds < p.cost || (t === 'gas' && this.counts.terminal === 0);
                el.classList.toggle('disabled', disabled);
                el.querySelector('.b-cost').textContent = `$${p.cost}`;
            });
        },

        float(x, y, text, type) {
            const el = document.createElement('div');
            el.className = `float-text ${type}`;
            el.textContent = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }
    };

    function switchTab(name) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.textContent.includes(name === 'build' ? 'Âª∫Ë®≠' : name === 'fuel' ? 'ÁáÉÊñô' : 'Ë≥áË®ä')));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === `tab-${name}`));
    }

    window.onload = () => game.init();
    </script>
</body>
</html>
