<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
  <title>物理小測驗</title>
 
    <link rel=stylesheet href=jquery.mobile-1.4.5.min.css>
    <script src=jquery-2.2.4.min.js></script>
    <script src=jquery.mobile-1.4.5.min.js></script>
    <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
  
    <body>  

    <div data-role="page">
      
      <div data-role="header" data-position="fixed">
        <h1>物理測驗</h1>
      </div>
      
      <div data-role="content">

        <div data-role="content">
        
          <h4 id="questionTitle"></h4>        
          <h4 id="question"></h4>
          <h4 id="chooseAnswer"></h4>
          <h3 id="spendtime" style="text-align:center;" style='visibility:hidden'><h3>
     
        <div  id="answer" data-role="controlgroup" data-type="vertical"  style='visibility:hidden'>
     
          <button id="answer1" onclick="check(this)"></button>
          <button id="answer2" onclick="check(this)"></button>
          <button id="answer3" onclick="check(this)"></button>
          <button id="answer4" onclick="check(this)"></button>

        </div>
        <div>
        <div  data-role="content">      
        <div id="forusername" data-role="fieldcontain">     
          <label  for="username">輸入姓名:</label>
          <input type="text"  style="text-align:center;" id="username">
        </div>
          <button id="sendBtn">開始測驗</button>
          <p id="timer" style='visibility:hidden'><p>
        </div>
          <p id="correctAnswer" style='visibility:hidden'><p>
        </div>
 
        <div data-role="footer" data-position="fixed" data-theme="b">
          <h4>&copy;Guidephy</h4>
        </div>
      
        </div>     
     </body>
  

  
 <script> 
     var t;
     var x=[];
     var y=[];
      
     var wrong;
     var questionNumber;
     var questioncontent;
     var answercontent;
      
      sendBtn = $('#sendBtn');
      show = $('#question');
      questionTitle= $('#questionTitle');    
      answer1=$('#answer1');
      answer2=$('#answer2');
      answer3=$('#answer3');
      answer4=$('#answer4');
      chooseAnswer=$('#chooseAnswer');
      correctAnswer=$('#correctAnswer');


   
      
     var times;
     var parameter = {};

     parameter = {
            startRow: x,
            startColumn: 2
                    };
        $.get("https://script.google.com/macros/s/AKfycbzUbcZB6H3X_ZiiYxFHH8dBMNHkrMm3Zm2jZ-7tw-qGgZ3gu6g/exec", parameter, function(data) {
        
              questioncontent=data.split(",");

              $.get("https://script.google.com/macros/s/AKfycbw4O63qhdjUXWsRxY9xrRYc_jIqOLiPjdMD7leVbt4Usrnfb2sg/exec", parameter, function(data) {
     
             answercontent=data.split(","); 
             });       

      });

   
     var myVar=setInterval(function(){myTimer()},1000);

     sendBtn.on('click',function() {
      if (document.getElementById("username").value==""){
         alert("請輪入姓名"); 
      }else if(answercontent==null){
         alert("題目下載中，請再試一次"); 
      }else{
        

        wrong=0;
        questionNumber=10;
        document.getElementById("username").style.visibility='hidden';
        document.getElementById("forusername").style.visibility='hidden';
        t=0;
        document.getElementById("spendtime").style.visibility='hidden';
        document.getElementById("spendtime").innerHTML="";
        chooseAnswer.text("");  
        
        
        times=1;

        var index = 1;


        while (index < 11) {


                       var flag = true;
                       var num = Math.floor(Math.random() * 83)+2;
                       for (var i in x) {
                       if (x[i] == num) {
                       flag = false;
                       }
                       }
                       if (flag == true) {
                       x[index] = num;
                       index++;
                       }
                    }

        var index1=0;

        while (index1 < 4) {


                       var flag = true;
                       var num = Math.floor(Math.random() * 83)+2;
                       for (var i in y) {
                       if (y[i] == num||num==x[times]) {
                       flag = false;
                       }
                       }
                       if (flag == true) {
                       y[index1] = num;
                       index1++;
                       }
                    }



             document.getElementById("sendBtn").style.visibility='hidden';
             show.text(questioncontent[x[times]]);
            
     
             y[0]=x[times];
             y=y.sort(function() {return Math.random() - 0.5});

             answer1.text(answercontent[y[0]]);
             answer2.text(answercontent[y[1]]);
             answer3.text(answercontent[y[2]]);
             answer4.text(answercontent[y[3]]);

     
             questionTitle.text("題目"+times);
             chooseAnswer.text("請選擇答案");        
             sendBtn.text("再玩一次");  
             correctAnswer.text(answercontent[x[times]]);

              clearInterval(myVar);
        myVar=setInterval(function(){myTimer()},1000);
 
      function myTimer()
      {
         t=t+1;
        document.getElementById("timer").innerHTML="遊戲時間:"+t+"秒";
      }
        document.getElementById("question").style.visibility='visible';
        document.getElementById("answer").style.visibility='visible'; 
       
     }

     });
         
        
          
         
       
   
   function check(id) { 
            if(id.innerHTML==document.getElementById("correctAnswer").innerHTML&&times<3){
              times=times+1;
              
              parameter = {
              startRow: x,
              startColumn: 2
             };
      
          document.getElementById("answer").style.visibility='hidden'; 
          document.getElementById("question").style.visibility='hidden';
           //alert("答對了，再來一題");  
          questionTitle.text("題目"+times);
           show.text(questioncontent[x[times]]);
            

            var index1=0;

        while (index1 < 4) {


                       var flag = true;
                       var num = Math.floor(Math.random() * 83)+2;
                       for (var i in y) {
                       if (y[i] == num||num==x[times]) {
                       flag = false;
                       }
                       }
                       if (flag == true) {
                       y[index1] = num;
                       index1++;
                       }
                    }
             y[0]=x[times];
             y=y.sort(function() {return Math.random() - 0.5});
             answer1.text(answercontent[y[0]]);
             answer2.text(answercontent[y[1]]);
             answer3.text(answercontent[y[2]]);
             answer4.text(answercontent[y[3]]);


             questionTitle.text("題目"+times);
             chooseAnswer.text("請選擇答案");        
             
             correctAnswer.text(answercontent[x[times]]);
          
  
          document.getElementById("answer").style.visibility='visible'; 
          document.getElementById("question").style.visibility='visible';  
          
        
         }else if(id.innerHTML==document.getElementById("correctAnswer").innerHTML && times==3){
          var gametime=t;
          var correctRatio=100*(questionNumber-wrong)/questionNumber;
          correctRatio = correctRatio.toFixed(2);
          var gamedata=new Date();

          document.getElementById("answer").style.visibility='hidden'; 
          document.getElementById("question").style.visibility='hidden';
     
          questionTitle.text("");
          show.text("");
          answer1.text("");
          answer2.text("");
          answer3.text("");
          answer4.text("");

          document.getElementById("spendtime").style.visibility='visible';
            $.get("https://script.google.com/macros/s/AKfycbwDmtyIaKjs5UvMjC0ybhXC7PCLGpuSgyQsmUacQWW5hu6O5Bzt/exec", {
                        "name": document.getElementById("username").value,
                        "gamedata":gamedata.getFullYear()+ "/" + (gamedata.getMonth()+1) + "/" + gamedata.getDate()+" "+gamedata.getHours()+":"+gamedata.getMinutes()  ,
                        "gametime":gametime,
                        "correctRatio":correctRatio
                    },
                    function (data) {
                       
                    });
                    
        

          document.getElementById("spendtime").innerHTML=document.getElementById("username").value+"<br>恭喜你完成測驗，<br>此次測驗共花了"+gametime+"秒，<br>答對率="+correctRatio+"%";
          chooseAnswer.text(""); 
          document.getElementById("sendBtn").style.visibility='visible';
    }else{
      questionNumber=questionNumber+1;
      wrong=wrong+1;
      alert("答錯了");
    };
        }
 </script>
                                                                                                   
</html>